---
title: 'Reproducible Research: Peer Assessment 1'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading and preprocessing the data
remove all objects

```{r}
rm(list=ls())
```

set working directory: we skip this step and let the reader set their own working directory. 
we check if the source file is loaded onto the wd of the reader, if not, we download it and unzip the file:

```{r}
if(!file.exists("activity.csv")) {
        tempfile <- tempfile()
        download.file("http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip",destfile = tempfile)
        unzip(tempfile)
        unlink(tempfile)
}
```

load data
```{r echo = TRUE}
activity <- read.csv("activity.csv")
summary(activity)
str(activity)
```
## What is mean total number of steps taken per day?
```{r}
activity_steps_day <- aggregate(steps ~ date, data = activity, FUN = sum, na.rm = TRUE)
hist(activity_steps_day$steps, xlab = "Steps per Day", main = "Total number of steps taken per day", col = "wheat")
mean_steps <- mean(activity_steps_day$steps)
median_steps <- median(activity_steps_day$steps)
```
we set a normal number format to display the results
```{r}
mean_steps <- format(mean_steps,digits=1)
median_steps <- format(median_steps,digits=1)
```
## What is the average daily activity pattern?
Aggregate function for mean over all days, for each interval
```{r}
activity_steps_mean <- aggregate(steps ~ interval, data = activity, FUN = mean, na.rm = TRUE)
```
Plot
```{r}
plot(activity_steps_mean$interval, activity_steps_mean$steps, type = "l", col = "tan3", xlab = "Intervals", ylab = "Total steps per interval", main = "Number of steps per interval (averaged) (NA removed)")
```

what is the highest steps value? (maximum of steps on one given interval)
```{r}
max_steps <-max(activity_steps_mean$steps)
```

for which interval are the numbers of steps per interval at the highest?
```{r}
max_interval <- activity_steps_mean$interval[which(activity_steps_mean$steps == max_steps)]
max_steps <- round(max_steps, digits = 2)
```

## Imputing missing values
```{r}
sum(is.na(activity))
```

subset general dataset with missing values only
```{r}
missing_values <- subset(activity, is.na(steps))
```

plot repartition, by date or by intervals
```{r}
par(mfrow = c(2,1), mar = c(2, 2, 1, 1))
hist(missing_values$interval, main="NAs repartition per interval")
hist(as.numeric(missing_values$date), main = "NAs repartion per date", breaks = 61)
```

calculate mean of steps per interval, we end up with a mean for all 288 intervals
```{r}
MeanStepsPerInterval <- tapply(activity$steps, activity$interval, mean, na.rm = TRUE)
```

cut the 'activity' dataset in 2 parts (with and without NAs)
```{r}
activity_NAs <- activity[is.na(activity$steps),]
activity_non_NAs <- activity[!is.na(activity$steps),]
```

replace missing values in activity_NAs
```{r}
activity_NAs$steps <- as.factor(activity_NAs$interval)
levels(activity_NAs$steps) <- MeanStepsPerInterval
```

change the vector back as integer
```{r}
levels(activity_NAs$steps) <- round(as.numeric(levels(activity_NAs$steps)))
activity_NAs$steps <- as.integer(as.vector(activity_NAs$steps))
```

merge/rbind the two datasets together
```{r}
imputed_activity <- rbind(activity_NAs, activity_non_NAs)
```

Plotting parameters to place previous histogram and new one next to 
we set a normal number format to display the results each other
```{r}
par(mfrow = c(1,2))
```

Plot again the histogram from the first part of the assignment
```{r}
activity_steps_day <- aggregate(steps ~ date, data = activity, FUN = sum, na.rm = TRUE)
hist(activity_steps_day$steps, xlab = "Steps per Day", main = "NAs REMOVED - Total steps/day", col = "wheat")
```

Plot new histogram, with imputed missing values
```{r}
imp_activity_steps_day <- aggregate(steps ~ date, data = imputed_activity, FUN = sum, na.rm = TRUE)
hist(imp_activity_steps_day$steps, xlab = "Steps per Day", main = "NAs IMPUTED - Total steps/day", col = "wheat")
imp_mean_steps <- mean(imp_activity_steps_day$steps)
imp_median_steps <- median(imp_activity_steps_day$steps)
```

we set a normal number format to display the results
```{r}
imp_mean_steps <- format(imp_mean_steps,digits=1)
imp_median_steps <- format(imp_median_steps,digits=1)
```

store the results in a dataframe
```{r results = 'asis'}
results_mean_median <- data.frame(c(mean_steps, median_steps), c(imp_mean_steps, imp_median_steps))
colnames(results_mean_median) <- c("NA removed", "Imputed NA values")
rownames(results_mean_median) <- c("mean", "median")
library(xtable)
xt <- xtable(results_mean_median)
print(xt, type  = "html")
```

## Are there differences in activity patterns between weekdays and weekends?
elseif function to categorize Saturday and Sunday as factor level "weekend", all the rest as "weekday"
```{r}
imputed_activity$dayType <- ifelse(weekdays(as.Date(imputed_activity$date)) == "Samstag" | weekdays(as.Date(imputed_activity$date)) == "Sonntag", "weekend", "weekday")
```

transform dayType variable into factor
```{r}
imputed_activity$dayType <- factor(imputed_activity$dayType)
```

Aggregate a table showing mean steps for all intervals, acrlss week days and weekend days
```{r}
steps_interval_dayType <- aggregate(steps ~ interval + dayType, data = imputed_activity, FUN = mean)
```

verify new dataframe 
```{r}
head(steps_interval_dayType)
```

add descriptive variables
```{r}
names(steps_interval_dayType) <- c("interval", "day_type", "mean_steps")
```

plot with ggplot2
```{r}
library(ggplot2)
plot <- ggplot(steps_interval_dayType, aes(interval, mean_steps))
plot + geom_line(color = "tan3") + facet_grid(day_type~.) + labs(x = "Intervals", y = "Average Steps", title = "Activity Patterns")
```
